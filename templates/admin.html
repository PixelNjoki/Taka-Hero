<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard | Taka Hero</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>
  <nav class="navbar p-3">
    <h2>Taka Hero Admin</h2>
    <button id="darkToggle" class="btn btn-outline-light">ğŸŒ™</button>
  </nav>

  <div class="container" style="padding: 20px;">
    <h2>ğŸ“Š Reports Overview</h2>

    <div style="margin-bottom: 20px;">
      <label>Filter Reports:</label>
      <select id="statusFilter" class="form-control">
        <option value="all">All</option>
        <option value="Pending">Pending</option>
        <option value="Verified">Verified</option>
        <option value="Collected">Collected</option>
      </select>
    </div>

    <canvas id="reportChart" height="100"></canvas>

    <div class="grid" style="display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-top:30px;">
      {% for report in reports %}
      <div class="card report-card" data-status="{{ report.status }}">
        <img src="{{ url_for('static', filename='uploads/' + (report.image_filename or 'placeholder.jpg')) }}" style="width:100%; border-radius:10px;">
        <div class="p-3">
          <h4>{{ report.name }}</h4>
          <p><b>ğŸ“</b> {{ report.location }}</p>
          <p>{{ report.description }}</p>

          <span class="badge"
            style="background: {% if report.status == 'Pending' %}#ffc107{% elif report.status == 'Verified' %}#4caf50{% else %}#2196f3{% endif %}; color:white; padding:5px 10px; border-radius:10px;">
            {{ report.status }}
          </span>

          <div class="mt-2">
            <a href="{{ url_for('update_status', report_id=report.id, status='Verified') }}" class="btn btn-green btn-sm">Verify</a>
            <a href="{{ url_for('update_status', report_id=report.id, status='Collected') }}" class="btn btn-outline-dark btn-sm">Mark Collected</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/script.js') }}"></script>

  <script>
    // Filter dropdown
    const filter = document.getElementById('statusFilter');
    const cards = document.querySelectorAll('.report-card');
    filter.addEventListener('change', () => {
      const val = filter.value;
      cards.forEach(card => {
        card.style.display = (val === 'all' || card.dataset.status === val) ? 'block' : 'none';
      });
    });

    // Chart.js setup
    const ctx = document.getElementById('reportChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Pending', 'Verified', 'Collected'],
        datasets: [{
          label: 'Number of Reports',
          data: [
            {{ reports|selectattr('status', 'equalto', 'Pending')|list|length }},
            {{ reports|selectattr('status', 'equalto', 'Verified')|list|length }},
            {{ reports|selectattr('status', 'equalto', 'Collected')|list|length }}
          ],
          backgroundColor: ['#ffc107','#4caf50','#2196f3']
        }]
      }
    });
  </script>
</body>
</html>
